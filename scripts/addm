#!/usr/bin/env bash
set -euo pipefail

if [ -z "${1-}" ]; then
  echo "Usage: $0 <YouTube-URL>"
  exit 1
fi

URL="$1"
OUTDIR="$HOME/Music"  # Change this if you want
TMPDIR="$(mktemp -d)"

# 1. Download and convert to MP3
yt-dlp --no-playlist \
       -x --audio-format mp3 \
       -o "$TMPDIR/%(title).200s.%(ext)s" \
       "$URL"

# 2. Prompt for metadata
read -rp "Enter Artist: " ARTIST
read -rp "Enter Title: " TITLE

# 3. Tag with eyeD3
MP3_FILE="$(find "$TMPDIR" -type f -name '*.mp3' | head -n 1)"
eyeD3 --artist="$ARTIST" --title="$TITLE" "$MP3_FILE"

# 4. Move to final destination
mv "$MP3_FILE" "$OUTDIR/"

# 5. Cleanup
rm -rf "$TMPDIR"

echo "âœ” Downloaded, tagged, and saved to $OUTDIR"
